---
snip: 18
title: Starknet 上质押的第一阶段
description: STRK 在 Starknet 上质押的 SW 提案
author: Natan Granit <natan@starkware.co>
discussions-to: https://community.starknet.io/t/snip-18-staking-s-first-stage-on-starknet/114334
status: Review
type: Standards Track
category: Core
created: 2024-07-10
---

# Starknet 上质押的第一阶段

## 摘要

随着 Starknet 继续其去中心化的旅程，我们提出了 StarkWare 关于质押第一阶段的提案。这是建立质押社区和技术的重要一步，为用户和开发者提供了新的机会。

本 SNIP 旨在于 2024 年第四季度在 Starknet 主网上线质押的第一阶段，特点是无权限的链上质押协议和质押委托。

在本 SNIP 中，我们将详细描述质押提案、其时间表以及与未来去中心化步骤的关系。

## 动机

质押的第一阶段标志着 Starknet 去中心化 [愿景](https://starkware.co/integrity-matters-blog/starknet-vision/) 的另一个关键步骤。以下是 Starknet 去中心化过程中的增量方法和提议的第一步的主要动机。

未来，作为 Starknet 共识协议的一部分，质押者将负责通过生成、证明和验证区块来维护和保护网络。然而，一次性交接这些责任并不可行。这就是为什么需要增量方法，因为它允许以下几点：

* **渐进实施：** PoS 协议是一个复杂的结构，需要全面的测试和验证。通过以小而可管理的里程碑引入其特性，我们确保每一步都经过仔细实施并易于集成。这种方法还允许我们在问题出现时进行改进和解决。
* **质押者的准备：** 给质押者时间适应新责任，确保他们为关键角色做好准备，并在过渡期间最大限度地提高网络稳定性。
* **经过验证的可靠性：** 当质押者执行上述角色时，我们希望拥有一组经过验证的序列器，能够可靠地生成和证明区块，从而确保网络的稳定性和性能。

具体来说，在这个提议的第一阶段中，我们将测试协议的经济激励结构和一些关键智能合约组件。协议的奖励结构必须在激励参与与维持可持续的通货膨胀率之间取得平衡，并允许足够数量的 STRK 保持可用于其他网络活动。

通过采用这种逐步的方法，借助提议的第一阶段，我们可以收集有价值的数据，进行关键测试，从而在实施过程中完善质押协议。

## 规范

### 概述

提议的第一阶段协议在 Starknet 上提供无权限的 STRK 质押，具有两种质押方式：

* **质押：** 作为质押者，您可以质押任何大于 20K 的 STRK。目前，质押者预计将运行完整节点，以为后续阶段做准备。未来，他们还需要运行额外的软件来排序和验证 Starknet 区块，并可能执行额外的网络活跃性和安全性任务。
* **质押委托：** 委托者选择一个质押者，将其质押委托给该质押者，并与该质押者共享奖励。质押委托者不需要运行任何软件，因为他们选择的质押者为他们运行。这使得更广泛的受众能够参与，使用户能够在没有技术和资本限制的情况下参与质押协议。

质押者和质押委托者都可以解除质押其资金，受协议定义的延迟限制，以确保网络的稳定性和安全性。有关这些延迟的更多详细信息，请参见“延迟”部分。

### 质押奖励

质押奖励将基于代币铸造。奖励根据铸造曲线计算，该曲线遵循诺姆·尼桑教授的 [提案](https://starkware.co/a-token-minting-proposal-to-manage-inflation/)（有关铸造曲线的更多详细信息，请参见下面的部分）。质押者和质押委托者根据各自的质押和质押者设定的奖励分享常数 (R) 获得奖励：

* **质押者：** 根据他们自己的质押和委托给他们的总质押，按奖励分享常数调整获得奖励。公式为：

    `({self_stake} + {total_stake_delegated} * (1 - R)) * {rewards_constant} * {time_interval}`

* **质押委托者：** 根据他们的委托质押和奖励分享常数获得奖励。公式为：

    `{stake_delegated} * R * {rewards_constant} * {time_interval}`

其中 `{rewards_constant}` 由铸造曲线确定，并取决于协议中质押的总金额。该奖励结构激励质押、质押委托以及质押者之间为委托者的质押而竞争。

### 铸造曲线

铸造曲线通过使奖励依赖于锁定在协议中的 STRK 数量，解决了质押协议的两个关键方面。其工作原理如下：

* **平衡参与：** 锁定在质押协议中的 STRK 代币越多，奖励就越低。这种设计确保并非所有 STRK 代币都被质押，从而允许 Starknet 社区继续使用 STRK 进行交易费用和其他活动。此外，它还防止了代币供应的不必要稀释。

* **鼓励质押：** 当质押的 STRK 代币较少时，奖励会更高。这激励参与质押协议，确保网络的最低经济安全水平，确保一部分 STRK 代币始终被质押。
在第一阶段，铸造曲线将基于诺姆·尼桑教授的 [提案](https://starkware.co/a-token-minting-proposal-to-manage-inflation/)，并略有参数变化。铸造曲线由以下公式定义：

`M = C/10 * √ S`

其中 S 是质押率，占代币总供应量的百分比，M 是年铸造率，同样以代币总供应量的百分比表示，C 是最大理论通货膨胀率，也以年百分比表示。在尼桑教授的建议中，C=4，假设所有 10B STRK 代币可能参与质押协议。对于这一第一阶段，我们建议 C 在 1.8-2.5 的范围内，考虑到当前流通供应量远低于 10B，并且并非所有 STRK 代币都将参与质押协议。

决定全球通货膨胀上限和确切的铸造曲线参数是一个复杂的问题。任何决定都可能需要随着市场条件的变化而进行调整，例如流通代币的数量。鉴于这一主题的敏感性，我们建议 Starknet 基金会 (SNF) 举行治理投票，以决定铸造曲线参数及其随时间调整的过程。

### 延迟

* **今天：** 进入和退出质押协议是即时的，这意味着用户可以毫无延迟地加入或离开质押过程。然而，退出后，质押资金将受到 21 天的安全锁定期限制。在此期间，用户将无法获得奖励，也无法提取资金。该机制通过防止质押者突然提取大量质押并可能导致网络不稳定来确保网络安全。
* **未来版本：** 在未来版本中，我们将引入纪元的概念，纪元是基于区块的 Starknet 上的细粒度时间度量。这意味着进入或退出协议的延迟将由当前纪元剩余时间加上一个完整纪元的持续时间决定。退出协议后，提取锁定期仍然适用。
*尽管权益委托人提取资金时会面临安全锁定期，但他们可以在不等待完整锁定期的情况下在质押者之间移动，从而增强了委托市场的竞争力。

### 经济参数

以下是本版本中提议的经济参数的汇总表：

| **经济参数**                     | **提议值**                   |
|-----------------------------------|-------------------------------|
| 质押的最低 STRK (X)              | 20K STRK                     |
| 提取安全锁定期 (W)               | 21 天                        |
| 铸币曲线年通胀上限 (C)           | 1.8-2.5%                     |
| 奖励分享参数 (R)                 | 由质押者单独设定 (0-1)      |

这些值是我们为本版本协议提出的起始点。作为本版本背后的理由的一部分，它们可能会发生变化，并可能根据协议的需要进行调整。

### 锁定代币参与

锁定代币最初将被排除在质押之外。当质押者开始验证和投票由序列器排序的区块，并且他们的共识被证明给 L1 时，锁定代币将被允许参与质押协议。

### 一般要点

* 奖励通过主动发送交易来领取。
* 质押者和权益委托人都可以增加他们的质押。
* 不支持部分解质押。

## 理由

在 Starknet 上实施质押的设计采用渐进式方法，以确保网络的稳定性和安全性。逐步实施质押允许进行全面测试和顺利集成 PoS 协议，降低与突然转向去中心化相关的风险。这种分阶段的推出也为质押者提供了准备其角色的时间，确保他们准备好维护和保护网络。

动态奖励结构，特别是铸币曲线，平衡了激励参与与保持代币可用于其他网络活动之间的关系。

总之，上述设计确保了在 Starknet 去中心化旅程中的安全、稳定和渐进过渡。

## 安全考虑

质押协议的设计包括几个关键安全措施，以确保其完整性和用户安全。

### 模块化架构

提议的协议将采用模块化架构实施，其中不同的功能被分离到不同的合约中，例如质押、委托、奖励供应等。这种方法提供了几个优势：

* **简化逻辑：** 每个合约都有明确和特定的角色，使代码更易于测试、审计和理解。
* **增强访问控制：** 通过为每个合约定义特定权限，降低了未经授权访问或滥用的风险。
* **允许有针对性的升级和更改：** 仅更新相关合约最小化了引入新漏洞的潜在风险。

### 权限和密钥管理

质押协议允许用户为不同功能定义不同的地址。因此，活动较少的冷地址可以控制重要功能，减少暴露于威胁的风险，增强用户安全性。

质押者注册三个地址：

* **质押和解质押地址：** 此地址有权质押、增加质押和解质押。这意味着它处理大量的 STRK 代币，仅在进入或退出协议时需要。因此，可以由冷钱包（活动较少）持有，以最大化安全性。
* **奖励地址：** 这是奖励将被发送到的地址。它也可以保持活动较少，即作为冷钱包。
* **操作地址：** 此地址代表质押者用于操作目的（例如，未来的区块证明），并不处理大量资金。由于它将被频繁使用，因此应被归类为热地址。

权益委托人注册两个地址：

* **进入/退出地址：** 此地址有权委托质押、增加质押和解质押。这意味着它处理大量的 STRK 代币，仅在进入或退出协议时需要。因此，可以由冷钱包（活动较少）持有，以最大化安全性。
* **奖励地址：** 这是奖励将被发送到的地址。它也可以保持活动较少，即作为冷钱包。

**权限：** 协议在用户角色之间采用分层方法。控制较大资金的冷地址可以在被攻破时替换更活跃的地址。具体而言，质押者和权益委托人地址可以替换奖励地址。

### 安全锁定期

在退出时，用户面临 21 天的锁定期，在此期间无法获得奖励，也无法提取资金。这会抑制可能会破坏网络的突然大额提取。未来版本将把退出过程与周期挂钩，保持锁定期以确保安全退出机制。

## 里程碑

本 SNIP 旨在于 2024 年第四季度在 Starknet 主网上线质押的第一阶段，您可以在以下 [repo](https://github.com/starkware-libs/starknet-staking) 中跟踪实施进度。

未来阶段将包括逐步分配质押者的责任，最终验证和排序区块。这种渐进式过渡确保了稳定性，并允许进行全面测试和改进。有关去中心化协议的更多详细信息，请查看 @Ilia 的 [系列](https://community.starknet.io/t/starknet-decentralized-protocol-i-introduction/2671) 博客文章。

随着我们进展，将介绍更多关于后续阶段的详细信息和提案。下一步已经进入研究和规划阶段，计划在第一阶段后几个月内推出。我们的目标是顺利推出这些更新，并根据社区反馈进行持续改进。

## 版权

本 SNIP 将根据 MIT 许可证发布。